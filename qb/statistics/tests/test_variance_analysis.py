import numpy as np
from numpy.testing import assert_almost_equal, assert_equal
from qb.statistics.variance_analysis import difference_test, auto_cov, cross_cov


def test_difference_test():
    a = [13.3, 12.8, 14.7, 15.2, 16.4, 18.5, 21.9, 23.8, 23.7, 21.4, 18.0, 16.1]
    b = [14.2, 15.0, 14.6, 15.5, 16.4, 18.8, 22.5, 24.1, 22.5, 20.7, 18.6, 15.2]

    _, pvalue = difference_test(a, b)

    assert_equal(pvalue <= 0.05, False)


def test_auto_cov():
    a = [
        11.67602657, 5.637492979, 1.375516942, 0.618705492, -0.152047234,
        -0.508555434, -6.065288121, -9.417602801, -10.47205437, -8.018063902,
        0.523277554, 4.86893283, 4.23977562, -10.2344375, -3.463362573,
        36.51326577, -8.518370963, -15.37474905, -7.687911176, 4.818978874,
        7.876681639, 1.763788865
    ]
    assert_almost_equal(auto_cov(a, 3, True), -9.818640497993421)


def test_cross_cov():
    a = [
        6.3, 5.8, 5.3, 4.7, 4.2, 3.7, 3.3, 2.7, 5.3, 8.5,
        11.3, 11.8, 11.1, 10.3, 9.9, 9.7, 8.8, 7.6, 6.3, 4.8,
        3.6, 2.7, 2.1, 1.6
    ]
    b = [
        270.3, 298.4, 297.2, 274.4, 189.1, 137.4, 126.4, 120.2, 143.9, 103.4,
        327.5, 686.4, 786.4, 825.9, 1011.5, 1004.2, 926.4, 845.1, 766.1, 720.0,
        644.8, 622.4, 606.7, 569.4
    ]

    assert_almost_equal(cross_cov(a, b, tau=2, bias=True), 682.0919994212961)
